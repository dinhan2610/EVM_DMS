//
// Print & PDF Export Optimization
// ================================
//
// üìã OVERVIEW:
// CSS t·ªëi ∆∞u cho vi·ªác in ·∫•n v√† xu·∫•t PDF v·ªõi ph√¢n trang t·ª± ƒë·ªông
// Header v√† Footer c·ªßa h√≥a ƒë∆°n s·∫Ω t·ª± ƒë·ªông l·∫∑p l·∫°i tr√™n m·ªói trang
//
// üéØ FEATURES:
// - T·ª± ƒë·ªông ph√¢n trang khi n·ªôi dung d√†i
// - L·∫∑p l·∫°i header (th√¥ng tin c√¥ng ty, ti√™u ƒë·ªÅ) tr√™n m·ªói trang
// - L·∫∑p l·∫°i footer (t·ªïng ti·ªÅn, ch·ªØ k√Ω) tr√™n m·ªói trang
// - L·∫∑p l·∫°i table header (STT, T√™n h√†ng h√≥a, ƒêVT...) khi table d√†i
// - Tr√°nh ng·∫Øt trang gi·ªØa m·ªôt d√≤ng s·∫£n ph·∫©m
// - √Åp d·ª•ng khung n·ªÅn cho m·ªói trang
//
// üìÑ A4 PAGE SIZE: 210mm x 297mm
// üñ®Ô∏è PRINT CONTEXT ONLY: Ch·ªâ √°p d·ª•ng khi in ho·∫∑c xu·∫•t PDF
//

@media print {
  // ============================================
  // 1. ·∫®N T·∫§T C·∫¢ ELEMENTS NGO√ÄI H√ìA ƒê∆†N
  // ============================================
  
  // ·∫®n to√†n b·ªô page
  body * {
    visibility: hidden !important;
  }

  // Ch·ªâ hi·ªán invoice print area
  #invoice-print-area,
  #invoice-print-area * {
    visibility: visible !important;
  }

  // Position invoice ·ªü top-left
  #invoice-print-area {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  // ·∫®n c√°c th√†nh ph·∫ßn UI kh√¥ng c·∫ßn thi·∫øt
  .main-nav,
  .topbar,
  .button-toggle-menu,
  .button-sm-hover,
  footer,
  .no-print {
    display: none !important;
  }

  // ============================================
  // 2. PAGE SETUP - THI·∫æT L·∫¨P TRANG IN
  // ============================================
  
  @page {
    size: A4 portrait; // K√≠ch th∆∞·ªõc A4 d·ªçc
    margin: 1.5cm 1.2cm; // L·ªÅ tr√™n/d∆∞·ªõi 1.5cm, tr√°i/ph·∫£i 1.2cm
    
    // N·∫øu mu·ªën th√™m header/footer cho to√†n trang (s·ªë trang, ng√†y in...)
    // Uncomment n·∫øu c·∫ßn:
    // @top-right {
    //   content: "Trang " counter(page) " / " counter(pages);
    //   font-size: 9pt;
    //   color: #666;
    // }
  }

  // Lo·∫°i b·ªè page break m·∫∑c ƒë·ªãnh c·ªßa browser
  * {
    -webkit-print-color-adjust: exact !important; // Safari
    print-color-adjust: exact !important; // Firefox, Chrome
    color-adjust: exact !important; // Standard
  }

  // ============================================
  // 3. TABLE LAYOUT - C·∫§U TR√öC CH√çNH
  // ============================================
  
  // Table wrapper ch√≠nh c·ªßa h√≥a ƒë∆°n
  .invoice-print-wrapper {
    width: 100%;
    height: 100%;
    position: relative;
  }

  // Table layout ch√≠nh
  table.invoice-page-layout {
    width: 100%;
    border-collapse: collapse;
    page-break-after: auto;
    
    // QUAN TR·ªåNG: Cho ph√©p table ng·∫Øt trang
    page-break-inside: auto;
  }

  // ============================================
  // 4. HEADER - PH·∫¶N ƒê·∫¶U TRANG (L·∫∂P L·∫†I)
  // ============================================
  
  thead.invoice-page-header {
    // QUAN TR·ªåNG: L·∫∑p l·∫°i header tr√™n m·ªói trang
    display: table-header-group;
  }

  thead.invoice-page-header td {
    padding-bottom: 0.5cm;
  }

  // Styling cho header content
  .invoice-header-content {
    // Logo
    .company-logo {
      max-height: 40px;
      width: auto;
    }

    // Th√¥ng tin c√¥ng ty
    .company-info {
      margin-bottom: 0.3cm;
    }

    // QR Code
    .qr-code-box {
      width: 65px;
      height: 65px;
    }
  }

  // ============================================
  // 5. BODY - N·ªòI DUNG CH√çNH (NG·∫ÆT TRANG)
  // ============================================
  
  tbody.invoice-page-body {
    // QUAN TR·ªåNG: Cho ph√©p ng·∫Øt trang trong body
    display: table-row-group;
    page-break-inside: auto;
  }

  tbody.invoice-page-body td {
    padding: 0;
  }

  // ============================================
  // 6. TABLE S·∫¢N PH·∫®M - PH·∫¶N QUAN TR·ªåNG NH·∫§T
  // ============================================
  
  // Table s·∫£n ph·∫©m b√™n trong
  .invoice-products-table {
    width: 100%;
    border-collapse: collapse;
    page-break-inside: auto;
    
    // Border cho table
    border: 1px solid #000;
  }

  // Header c·ªßa table s·∫£n ph·∫©m - L·∫∂P L·∫†I
  .invoice-products-table thead {
    // QUAN TR·ªåNG: L·∫∑p l·∫°i table header tr√™n m·ªói trang
    display: table-header-group;
    
    tr {
      page-break-inside: avoid;
      page-break-after: auto;
    }
    
    th {
      background-color: #f5f5f5 !important;
      border: 1px solid #000 !important;
      padding: 5px 6px !important;
      font-weight: bold !important;
      font-size: 7.5pt !important;
    }
  }

  // Body c·ªßa table s·∫£n ph·∫©m
  .invoice-products-table tbody {
    display: table-row-group;
  }

  // QUAN TR·ªåNG: Tr√°nh ng·∫Øt trang gi·ªØa m·ªôt d√≤ng s·∫£n ph·∫©m
  .invoice-products-table tbody tr {
    page-break-inside: avoid;
    page-break-after: auto;
    
    td {
      border: 1px solid #000 !important;
      padding: 6px 8px !important;
      font-size: 8pt !important;
    }
  }

  // D√≤ng ƒë·∫ßu ti√™n c·ªßa trang m·ªõi (optional)
  .invoice-products-table tbody tr:first-child {
    page-break-before: auto;
  }

  // ============================================
  // 7. FOOTER - PH·∫¶N CU·ªêI TRANG (L·∫∂P L·∫†I)
  // ============================================
  
  tfoot.invoice-page-footer {
    // QUAN TR·ªåNG: L·∫∑p l·∫°i footer tr√™n m·ªói trang
    display: table-footer-group;
  }

  tfoot.invoice-page-footer td {
    padding-top: 0.5cm;
  }

  // Styling cho footer content
  .invoice-footer-content {
    // T·ªïng ti·ªÅn
    .invoice-summary {
      margin-bottom: 0.3cm;
    }

    // Ch·ªØ k√Ω
    .invoice-signatures {
      margin-top: 0.4cm;
    }
  }

  // ============================================
  // 8. BACKGROUND & BORDERS
  // ============================================
  
  // Background frame cho m·ªói trang
  .invoice-background-frame {
    background-image: var(--invoice-bg-url);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    min-height: 100%;
  }

  // Border v√† background colors
  .MuiPaper-root {
    box-shadow: none !important;
    background: white !important;
  }

  // ============================================
  // 9. TYPOGRAPHY & SPACING OPTIMIZATION
  // ============================================
  
  // Font sizes t·ªëi ∆∞u cho in
  .invoice-print-wrapper {
    font-size: 9pt;
    line-height: 1.4;
    color: #000;
    
    h1, h2, h3, h4, h5, h6 {
      page-break-after: avoid;
    }
    
    p {
      orphans: 3; // T·ªëi thi·ªÉu 3 d√≤ng ·ªü cu·ªëi trang
      widows: 3;  // T·ªëi thi·ªÉu 3 d√≤ng ·ªü ƒë·∫ßu trang m·ªõi
    }
  }

  // Ti√™u ƒë·ªÅ h√≥a ƒë∆°n
  .invoice-title {
    font-size: 14pt !important;
    font-weight: bold !important;
    margin-bottom: 0.2cm !important;
  }

  // Th√¥ng tin c√¥ng ty
  .company-name {
    font-size: 11pt !important;
    font-weight: bold !important;
  }

  .company-details {
    font-size: 7.5pt !important;
    line-height: 1.5 !important;
  }

  // Th√¥ng tin kh√°ch h√†ng
  .customer-info {
    font-size: 7.5pt !important;
    line-height: 1.5 !important;
    margin-bottom: 0.3cm !important;
  }

  // T·ªïng ti·ªÅn
  .invoice-total {
    font-size: 8.5pt !important;
    font-weight: bold !important;
  }

  // Ch·ªØ k√Ω
  .signature-box {
    font-size: 8pt !important;
  }

  // ============================================
  // 10. PREVENT BREAKING IN SPECIFIC SECTIONS
  // ============================================
  
  // C√°c sections kh√¥ng ƒë∆∞·ª£c ng·∫Øt gi·ªØa ch·ª´ng
  .no-page-break-inside {
    page-break-inside: avoid;
  }

  // Force page break tr∆∞·ªõc element
  .page-break-before {
    page-break-before: always;
  }

  // Force page break sau element
  .page-break-after {
    page-break-after: always;
  }

  // ============================================
  // 11. HIDE ELEMENTS IN PRINT
  // ============================================
  
  // ·∫®n c√°c buttons v√† controls
  button:not(.print-only),
  .btn:not(.print-only),
  .MuiButton-root:not(.print-only),
  input,
  select,
  textarea,
  .edit-controls,
  .toolbar,
  .navigation,
  .pagination {
    display: none !important;
  }

  // ============================================
  // 12. LINKS & COLORS
  // ============================================
  
  // Links kh√¥ng underline khi in
  a {
    text-decoration: none;
    color: inherit;
  }

  // ƒê·∫£m b·∫£o colors ƒë∆∞·ª£c in ƒë√∫ng
  * {
    background: transparent !important;
  }

  // Exceptions: gi·ªØ background cho c√°c elements c·∫ßn thi·∫øt
  thead th,
  .signature-box,
  .has-background {
    background: var(--bg-color) !important;
  }

  // ============================================
  // 13. RESPONSIVE PRINT - ƒêI·ªÄU CH·ªàNH THEO N·ªòI DUNG
  // ============================================
  
  // N·∫øu h√≥a ƒë∆°n qu√° d√†i (>100 d√≤ng s·∫£n ph·∫©m)
  @media print and (min-height: 297mm) {
    .invoice-products-table tbody tr {
      // Gi·∫£m padding ƒë·ªÉ fit nhi·ªÅu h∆°n
      td {
        padding: 4px 6px !important;
        font-size: 7.5pt !important;
      }
    }
  }

  // ============================================
  // 14. QUALITY OPTIMIZATION
  // ============================================
  
  // Render quality cao
  * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  // Image quality
  img {
    max-width: 100%;
    height: auto;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }

  // ============================================
  // 15. DEBUG MODE (Uncomment ƒë·ªÉ debug)
  // ============================================
  
  // Uncomment ƒë·ªÉ xem border c·ªßa c√°c ph·∫ßn t·ª≠ khi develop
  // * {
  //   outline: 1px solid red !important;
  // }
  
  // thead {
  //   outline: 2px solid blue !important;
  // }
  
  // tbody {
  //   outline: 2px solid green !important;
  // }
  
  // tfoot {
  //   outline: 2px solid orange !important;
  // }
}

// ============================================
// 16. SCREEN PREVIEW MODE
// ============================================

// Th√™m class n√†y ƒë·ªÉ preview print tr√™n m√†n h√¨nh
.print-preview-mode {
  // Gi·ªëng nh∆∞ @media print nh∆∞ng cho screen
  width: 210mm;
  min-height: 287mm;
  margin: 2cm auto;
  background: white;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
  padding: 1.5cm 1.2cm;
  
  // Apply c√°c styles gi·ªëng print
  font-size: 9pt;
  line-height: 1.4;
  color: #000;
  
  // ·∫®n buttons
  button:not(.print-only),
  .btn:not(.print-only),
  .edit-controls {
    display: none;
  }
}

// ============================================
// 17. SCREEN VIEW OPTIMIZATION (NON-PRINT)
// ============================================

// Styles for screen view (not in print mode)
@media screen {
  .invoice-print-wrapper {
    width: 210mm !important;
    min-height: 297mm;
    margin: 0;
    background: white;
    padding: 0;
    box-sizing: border-box;
    position: relative;
    display: block;
  }
  
  // Table layout should take full width and start from top
  table.invoice-page-layout {
    width: 100%;
    table-layout: fixed;
    margin: 0;
    padding: 0;
  }
  
  // Header should be at the top
  thead.invoice-page-header {
    display: table-header-group;
    vertical-align: top;
  }
  
  // Body should follow header
  tbody.invoice-page-body {
    display: table-row-group;
    vertical-align: top;
  }
  
  // Footer should be at the bottom
  tfoot.invoice-page-footer {
    display: table-footer-group;
    vertical-align: bottom;
  }
  
  // Company details should wrap text properly
  .company-details {
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal !important;
  }
  
  // Ensure Typography components wrap text
  .MuiTypography-root {
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal !important;
  }
}
